#!/bin/sh
set -e
set -u
set -x

GOLANG_VERSION_PATH=$(
	find /var/vcap/packages -maxdepth 1 -mindepth 1 -name 'golang-*-linux' |
	sort -Vr |
	tee /dev/stderr |
	head -1
)
. "${GOLANG_VERSION_PATH}/bosh/compile.env"

export GOPATH=${BOSH_COMPILE_TARGET}

cd "${BOSH_COMPILE_TARGET}/src/go-src"

# Create the executable file
go build -o generate_certs
install -sDvt "${BOSH_INSTALL_TARGET:?}/bin" generate_certs
